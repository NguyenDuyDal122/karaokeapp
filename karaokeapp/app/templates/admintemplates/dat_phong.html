{% extends "admintemplates/admin_base.html" %}
{% block title %}Qu·∫£n l√Ω ƒë·∫∑t ph√≤ng{% endblock %}

{% block content %}
<h3 class="mb-4">üìÖ Qu·∫£n l√Ω ƒë·∫∑t ph√≤ng</h3>

<form class="row mb-3">
    <div class="col-md-4">
        <input type="text" name="keyword"
               value="{{ keyword or '' }}"
               class="form-control"
               placeholder="üîç T√™n kh√°ch / ph√≤ng">
    </div>

    <div class="col-md-3">
        <select name="trang_thai" class="form-select">
            <option value="">-- T·∫•t c·∫£ tr·∫°ng th√°i --</option>
            {% for tt in ['CHO_XAC_NHAN','DA_XAC_NHAN','DANG_HAT','DA_THANH_TOAN','HUY'] %}
            <option value="{{ tt }}" {% if trang_thai==tt %}selected{% endif %}>
                {{ tt.replace('_',' ') }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <button class="btn btn-primary">L·ªçc</button>
    </div>
</form>

<table class="table table-bordered table-hover align-middle">
    <thead class="table-primary text-center">
        <tr>
            <th>ID</th>
            <th>Kh√°ch h√†ng</th>
            <th>Ph√≤ng</th>
            <th>Th·ªùi gian</th>
            <th>S·ªë ng∆∞·ªùi</th>
            <th>Tr·∫°ng th√°i</th>
            <th width="260">Thao t√°c</th>
        </tr>
    </thead>
    <tbody>
        {% for dp in ds_dat %}
        <tr class="text-center">
            <td>{{ dp.MaDatPhong }}</td>
            <td>{{ dp.khach_hang.HoTen }}</td>
            <td>{{ dp.phong.TenPhong }}</td>
            <td>
                {{ dp.ThoiGianBatDau.strftime("%d/%m %H:%M") }} <br>
                ‚Üí {{ dp.ThoiGianKetThuc.strftime("%H:%M") }}
            </td>
            <td>{{ dp.SoNguoi }}</td>

            <!-- ===== TR·∫†NG TH√ÅI ===== -->
            <td>
                {% if dp.TrangThai == 'CHO_XAC_NHAN' %}
                    <span class="badge bg-secondary">Ch·ªù x√°c nh·∫≠n</span>
                {% elif dp.TrangThai == 'DA_XAC_NHAN' %}
                    <span class="badge bg-primary">ƒê√£ x√°c nh·∫≠n</span>
                {% elif dp.TrangThai == 'DANG_HAT' %}
                    <span class="badge bg-success">ƒêang h√°t</span>
                {% elif dp.TrangThai == 'CHUA_THANH_TOAN' %}
                    <span class="badge bg-secondary">Ch∆∞a thanh to√°n</span>
                {% elif dp.TrangThai == 'DA_THANH_TOAN' %}
                    <span class="badge bg-warning text-dark">ƒê√£ thanh to√°n</span>
                {% else %}
                    <span class="badge bg-danger">ƒê√£ h·ªßy</span>
                {% endif %}
            </td>

            <!-- ===== THAO T√ÅC ===== -->
            <td>
                {% if dp.TrangThai == 'CHO_XAC_NHAN' %}
                    <a href="{{ url_for('cap_nhat_trang_thai_dat_phong',
                                        ma_dp=dp.MaDatPhong,
                                        trang_thai='DA_XAC_NHAN') }}"
                       class="btn btn-sm btn-success mb-1">‚úî X√°c nh·∫≠n</a>
                {% endif %}

                {% if dp.TrangThai == 'DA_XAC_NHAN' %}
                    <a href="{{ url_for('cap_nhat_trang_thai_dat_phong',
                                        ma_dp=dp.MaDatPhong,
                                        trang_thai='DANG_HAT') }}"
                       class="btn btn-sm btn-primary mb-1">üé§ ƒêang h√°t</a>
                {% endif %}

                {% if dp.TrangThai == 'DANG_HAT' %}
                    <a href="{{ url_for('cap_nhat_trang_thai_dat_phong',
                                        ma_dp=dp.MaDatPhong,
                                        trang_thai='CHUA_THANH_TOAN') }}"
                       class="btn btn-sm btn-warning mb-1">Ch∆∞a thanh to√°n</a>
                {% endif %}

                {% if dp.TrangThai == 'CHUA_THANH_TOAN' %}
                    <a href="{{ url_for('cap_nhat_trang_thai_dat_phong',
                                        ma_dp=dp.MaDatPhong,
                                        trang_thai='DA_THANH_TOAN') }}"
                       class="btn btn-sm btn-warning mb-1">üí∞ Thanh to√°n</a>
                {% endif %}

                {% if dp.TrangThai not in ['HUY', 'DA_THANH_TOAN'] %}
                    <a href="{{ url_for('cap_nhat_trang_thai_dat_phong',
                                        ma_dp=dp.MaDatPhong,
                                        trang_thai='HUY') }}"
                       onclick="return confirm('H·ªßy ƒë·∫∑t ph√≤ng n√†y?')"
                       class="btn btn-sm btn-danger mb-1">‚ùå H·ªßy</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
